<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .input-group {
            margin: 10px 0;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 5px;
            width: 100px;
        }
        input[type="text"] {
            width: 200px;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
        }
        td[contenteditable] {
            cursor: text;
        }
        td[contenteditable]:hover {
            background: #f0f4ff;
        }
        td[contenteditable]:focus {
            background: #e8efff;
            outline: 2px solid #667eea;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Google Sheets API Test Dashboard</h1>
        
        <div class="test-section" style="background: #e8f4ff; border: 2px solid #667eea;">
            <h2>üìã Sheet Selector</h2>
            <div class="input-group">
                <label>Select Sheet: </label>
                <select id="sheetSelector" style="padding: 8px; border-radius: 4px; margin: 0 10px;">
                    <option value="">Loading sheets...</option>
                </select>
                <button onclick="loadSheets()">üîÑ Refresh Sheets</button>
                <button onclick="loadSelectedSheet()">üìñ Load Selected Sheet</button>
            </div>
            <div id="sheetInfo" style="margin-top: 10px; color: #666;"></div>
        </div>
        
        <div class="test-section">
            <h2>üìñ Read Operations</h2>
            <button onclick="testReadAll()">Read All Data</button>
            <button onclick="testGetRange()">Get Specific Range</button>
            <div class="input-group">
                <label>Range: </label>
                <input type="text" id="rangeInput" placeholder="A1:C10" value="A1:D5">
            </div>
            <div id="readResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>‚úèÔ∏è Write Operations</h2>
            
            <h3>Update Single Cell</h3>
            <div class="input-group">
                <label>Row: </label>
                <input type="number" id="rowInput" value="2" min="1">
                <label>Column: </label>
                <input type="number" id="colInput" value="1" min="1">
                <label>Value: </label>
                <input type="text" id="valueInput" value="Test Value">
                <button onclick="testUpdateCell()">Update Cell</button>
            </div>
            
            <h3>Add New Row</h3>
            <div class="input-group">
                <input type="text" id="val1" placeholder="Value 1" value="John Doe">
                <input type="text" id="val2" placeholder="Value 2" value="Team A">
                <input type="text" id="val3" placeholder="Value 3" value="72">
                <button onclick="testAppendRow()">Append Row</button>
            </div>
            
            <div id="writeResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üìä Live Data View</h2>
            <button onclick="loadAndDisplayData()">Load Sheet Data</button>
            <div id="dataView" class="result"></div>
        </div>
    </div>

    <script src="sheets_api.js"></script>
    <script>
        // Current selected sheet
        let currentSheet = null;
        
        // Load available sheets
        async function loadSheets() {
            const selector = document.getElementById('sheetSelector');
            const infoDiv = document.getElementById('sheetInfo');
            
            try {
                const sheets = await sheetsAPI.listSheets();
                console.log('Available sheets:', sheets);
                
                selector.innerHTML = '<option value="">-- Select a sheet --</option>';
                sheets.forEach(sheet => {
                    const option = document.createElement('option');
                    option.value = sheet.name;
                    option.textContent = `${sheet.name} (${sheet.rows} rows, ${sheet.cols} cols)`;
                    selector.appendChild(option);
                });
                
                infoDiv.innerHTML = `<span class="success">‚úÖ Found ${sheets.length} sheets</span>`;
            } catch (error) {
                console.error('Failed to load sheets:', error);
                selector.innerHTML = '<option value="">Error loading sheets</option>';
                infoDiv.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        // Load selected sheet
        function loadSelectedSheet() {
            const selector = document.getElementById('sheetSelector');
            currentSheet = selector.value;
            
            if (!currentSheet) {
                alert('Please select a sheet first');
                return;
            }
            
            const infoDiv = document.getElementById('sheetInfo');
            infoDiv.innerHTML = `<span class="success">‚úÖ Working with sheet: "${currentSheet}"</span>`;
            
            // Auto-load data
            testReadAll();
        }
        
        // Test reading all data
        async function testReadAll() {
            const resultDiv = document.getElementById('readResult');
            resultDiv.innerHTML = '<div class="loading">Loading...</div>';
            
            try {
                const data = await sheetsAPI.readAll(currentSheet);
                console.log('Read successful:', data);
                
                let html = `<div class="success">‚úÖ Read successful from sheet: "${sheetsAPI.currentSheet || 'default'}"</div>`;
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Test getting specific range
        async function testGetRange() {
            const resultDiv = document.getElementById('readResult');
            const range = document.getElementById('rangeInput').value;
            
            if (!range) {
                resultDiv.innerHTML = '<div class="error">Please enter a range</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Loading...</div>';
            
            try {
                const data = await sheetsAPI.getRange(range, currentSheet);
                console.log('Range data:', data);
                
                let html = `<div class="success">‚úÖ Got range ${range}!</div>`;
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Test updating a cell
        async function testUpdateCell() {
            const resultDiv = document.getElementById('writeResult');
            const row = parseInt(document.getElementById('rowInput').value);
            const col = parseInt(document.getElementById('colInput').value);
            const value = document.getElementById('valueInput').value;
            
            if (!row || !col) {
                resultDiv.innerHTML = '<div class="error">Please enter row and column</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Updating...</div>';
            
            try {
                const result = await sheetsAPI.updateCell(row, col, value, currentSheet);
                console.log('Update result:', result);
                
                resultDiv.innerHTML = `<div class="success">‚úÖ Cell [${row},${col}] updated to "${value}" in sheet "${currentSheet || 'default'}"</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Test appending a row
        async function testAppendRow() {
            const resultDiv = document.getElementById('writeResult');
            const values = [
                document.getElementById('val1').value,
                document.getElementById('val2').value,
                document.getElementById('val3').value
            ];
            
            if (!values[0]) {
                resultDiv.innerHTML = '<div class="error">Please enter at least one value</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Adding row...</div>';
            
            try {
                const result = await sheetsAPI.appendRow(values, currentSheet);
                console.log('Append result:', result);
                
                resultDiv.innerHTML = `<div class="success">‚úÖ Row added: [${values.join(', ')}]</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Load and display data in a table
        async function loadAndDisplayData() {
            const resultDiv = document.getElementById('dataView');
            resultDiv.innerHTML = '<div class="loading">Loading sheet data...</div>';
            
            try {
                const data = await sheetsAPI.readAll(currentSheet);
                
                if (!data || data.length === 0) {
                    resultDiv.innerHTML = '<div>No data in sheet</div>';
                    return;
                }
                
                // Create table
                let html = '<table>';
                
                // Header row
                html += '<thead><tr>';
                data[0].forEach(header => {
                    html += `<th>${header || ''}</th>`;
                });
                html += '</tr></thead>';
                
                // Data rows
                html += '<tbody>';
                for (let i = 1; i < data.length; i++) {
                    html += '<tr>';
                    data[i].forEach((cell, j) => {
                        html += `<td contenteditable="true" 
                                     data-row="${i + 1}" 
                                     data-col="${j + 1}"
                                     onblur="handleEdit(this, ${i + 1}, ${j + 1})">${cell || ''}</td>`;
                    });
                    html += '</tr>';
                }
                html += '</tbody></table>';
                
                html += '<p style="margin-top: 10px; color: #666;">üí° Click any cell to edit it!</p>';
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Handle cell edits
        async function handleEdit(cell, row, col) {
            const newValue = cell.textContent;
            
            try {
                await sheetsAPI.updateCell(row, col, newValue, currentSheet);
                cell.style.background = '#d4edda';
                setTimeout(() => {
                    cell.style.background = '';
                }, 1000);
            } catch (error) {
                console.error('Failed to update cell:', error);
                cell.style.background = '#f8d7da';
                setTimeout(() => {
                    cell.style.background = '';
                }, 1000);
            }
        }
        
        // Test on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Google Sheets API Test Page Ready');
            console.log('Web App URL:', sheetsAPI.webAppUrl);
            
            // Load available sheets
            loadSheets();
        });
    </script>
</body>
</html>